import openai

client = openai.OpenAI()

def evaluate_service(transcript: str) -> dict:
    prompt = f"""
Ты — профессиональный аудитор сервиса. Клиент отправил текстовую расшифровку разговора сотрудника с клиентом. 
Твоя задача — проверить, насколько выполнены 5 столпов сервиса. Оцени по смыслу, а не по фразам. Язык может быть любой: русский, казахский, английский и т.д.

Вот 5 столпов сервиса:
1. Приветствие — сотрудник поприветствовал клиента.
2. Выявление потребности — выяснил, что интересует клиента, какие у него цели, вопросы.
3. Аргументация — обосновал выгоды, предложил решение или объяснил преимущества.
4. Завершение сделки — подвел к действию (оформлению, оплате, финальному решению).
5. Прощание — попрощался, пожелал хорошего дня или аналогичное.

Вот транскрипт:
\"\"\"
{transcript}
\"\"\"

Проанализируй и выведи результат в формате словаря Python строго вот так:
{{
    "1. Приветствие": "✅" или "❌",
    "2. Выявление потребности": "✅" или "❌",
    "3. Аргументация": "✅" или "❌",
    "4. Завершение сделки": "✅" или "❌",
    "5. Прощание": "✅" или "❌"
}}
"""

    response = client.chat.completions.create(
        model="gpt-4o",
        messages=[{"role": "user", "content": prompt}],
        temperature=0
    )

    return eval(response.choices[0].message.content)
